#!/bin/bash

user_input_jira_id="$1"

confirm() {
  echo
  read -p "${1} (y/n) " -n 1 input
  echo
  [[ "${input}" =~ ^[Yy]$ ]] && return 0 || return 1
}

# Fetch the Jira issue.
echo "Fetching $user_input_jira_id Jira issue..."
api_url="$JIRA_BASE_URL/rest/api/latest/issue/$user_input_jira_id"
response=$(curl -u "$JIRA_EMAIL:$JIRA_TOKEN" -H "Content-Type: application/json" "$api_url")
issue_id=$(echo "$response" | jq -r '.key')
issue_title=$(echo "$response" | jq -r '.fields.summary')

# Check if the issue key is null
if [ "$issue_id" == "null" ]; then
  echo -e "\n$response"
  exit 1
fi

# Confirm the issue is correct.
confirm "$issue_id: $issue_title" || exit


# Create the branch.
issue_type=$(echo "$response" | jq -r '.fields.issuetype.name')
branch="$issue_id-$issue_type"
echo "Creating $branch branch off of main..."
# TODO: Make branch with "{user_input_jira_id}-{type}"
# git checkout main && git pull && git checkout -b ga-a$(openssl rand -hex 3)


# Set Jira ticket "In Progress".


# Assign me to the ticket.
